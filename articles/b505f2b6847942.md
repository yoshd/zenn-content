---
title: "Godot ã§ Photon Realtime ã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Godot", "game", "network"]
published: false
---

ã“ã®è¨˜äº‹ã¯ [Godot Engine Advent Calendar 2023](https://qiita.com/advent-calendar/2023/godot-engine) 14æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

# ã¯ã˜ã‚ã«

ã¡ã‚‡ã£ã¨ã—ãŸå°ãƒã‚¿ã§ã™ã€‚
æ›¸ã„ã¦ã¿ãŸã‚‰æ€ã£ãŸã»ã©æ›¸ãã“ã¨ãŒç„¡ã‹ã£ãŸã®ã§ Godot ã§ Photon Realtime ãŒå‹•ãã¨ã„ã†ã“ã¨ã ã‘å…ˆã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚
ã“ã“ã¾ã§ã§èª­ã‚€ã®ã‚’æ­¢ã‚ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚

Godot ã§ã¯ã€å…¬å¼ã« C# ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ãŠã‚Šã€ .NET 6.0 ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
(ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«ã‚ˆã£ã¦ Rust ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãªã©ã‚‚æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚)

ã¤ã¾ã‚Šã€ .NET 6 ã§åˆ©ç”¨ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚‰å¤§ä½“ä½•ã§ã‚‚å‹•ããã†ã§ã™ã­ã€‚

# Photon Realtime

Unity ã§ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚’é–‹ç™ºã—ãŸã“ã¨ãŒã‚ã‚‹äººãªã‚‰ã”å­˜ã˜ã®äººãŒå¤šã„ã¨æ€ã„ã¾ã™ãŒã€ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ã®é€šä¿¡ã«åˆ©ç”¨ã§ãã‚‹ SaaS ã¨ã—ã¦ [Photon](https://www.photonengine.com/ja-jp) ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

Photon ã«ã‚‚è‰²ã€…ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡(Fusion ã‚„ Quantum ãªã©)ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ [Photon Realtime](https://www.photonengine.com/ja-jp/realtime) ã¨ã„ã†æœ€ã‚‚ãƒ—ãƒ¬ãƒ¼ãƒ³ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# Godot ã§ Photon Realtime SDK ã‚’å°å…¥ã™ã‚‹

Photon ã® Fusion ã‚„ PUN2 ãªã©ã¯ã€ Unity ã«ä¾å­˜ã—ã¦ã„ã‚‹ãŸã‚ Godot ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ãŒã€ Realtime ã¯ .NET ç”¨ã® SDK ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€åˆ©ç”¨å¯èƒ½ãªã“ã¨ãŒæœŸå¾…ã§ãã¾ã™ã€‚

.NET ç”¨ã® SDK ã¯ [ã“ã¡ã‚‰](https://www.photonengine.com/ja-jp/sdks#realtime-sdkrealtimenet) ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ SDK ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é©åˆ‡ãªå ´æ‰€ã«é…ç½®ã—ãŸã‚‰ã€ `csproj` ã«ä»¥ä¸‹ã®ã‚ˆã†ã« SDK ã® dll ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹ã ã‘ã§ã™ã€‚ä»¥ä¸Šï¼

```xml
  <ItemGroup>
    <Reference Include="Photon-NetStandard Version=4.1.7.0">
      <HintPath>./Photon/libs/Release/netstandard2.0/Photon-NetStandard.dll</HintPath>
    </Reference>
  </ItemGroup>
```

ã‚ã¨ã¯ Unity ã§åˆ©ç”¨ã™ã‚‹ã¨ãã¨åŒã˜ã‚ˆã†ã«ã€ Photon ã® `IConnectionCallbacks` ã‚„ `IMatchmakingCallbacks` ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã€åˆ©ç”¨æ™‚ã« `_Process` ãªã©æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ `Photon.Realtime.LoadBalancingClient.Service` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã™ã‚‹ã ã‘ã§ã™ã€‚

ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```cs
using Godot;
using Photon.Realtime;

public partial class MyNode : Node, IConnectionCallbacks
{
    private readonly LoadBalancingClient _client = new();

    public override void _Ready()
    {
        _client.AddCallbackTarget(this);
        _client.ConnectUsingSettings(new AppSettings
        {
            AppIdRealtime = "YourAppId"
        });
    }

    public override void _Process(double delta)
    {
        _client.Service();
    }

    #region IConnectionCallbacks implementation

    public void OnConnected()
    {
        GD.Print("OnConnected!");
    }

    public void OnConnectedToMaster()
    {
        GD.Print("OnConnectedToMaster!");
        _client.OpJoinOrCreateRoom(new EnterRoomParams
        {
            RoomName = "MyRoom",
            RoomOptions = new RoomOptions
            {
                PublishUserId = true
            }
        });
    }

    public void OnDisconnected(DisconnectCause cause)
    {
        GD.Print("OnDisconnected!");
    }

    // çœç•¥
    #endregion
}
```

# ã¾ã¨ã‚

Godot ã§ã‚‚ Photon Realtime ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚
